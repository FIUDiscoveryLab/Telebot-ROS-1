//This program subscribes to telebot and shows its messages on the screen

//This header defines the standard ROS classes.
#include <ros/ros.h>
#include <telebot/Coord.h>
#include "SimpleSerial.h"

void dataMessageRecieved(const telebot::Coord msg) {
     
	std::ostringstream ID;
	std::ostringstream GOAL;	
	std::ostringstream SPD;
	

        for(int i = 0; i < 12; i++){
	ID << msg.ID[i];
	GOAL << msg.GOAL_POS[i];
	SPD << msg.SPEED[i];
	
	
	std::string data = std::string() + '<' + ID.str() + ' ' + GOAL.str() + ' ' + SPD.str() + '>';	
	ROS_INFO_STREAM(data);
        SimpleSerial serial("/dev/ttyUSB0",57600);

        serial.writeString(data);
	}
}

int main(int argc, char **argv) {
     //Initialize the ROS system and become a node
     ros::init(argc, argv, "telebot_sub");
     ros::NodeHandle nh;

     //Create a subscriber object
     ros::Subscriber sub = nh.subscribe("motor_coord", 1000, &dataMessageRecieved);

     //Let ROS take over
     ros::spin();
     
}
